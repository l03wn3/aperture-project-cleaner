to replaceText(someText, oldItem, newItem)	(*     replace all occurances of oldItem with newItem          parameters -     someText [text]: the text containing the item(s) to change                    oldItem [text, list of text]: the item to be replaced                    newItem [text]: the item to replace with          returns [text]:     the text with the item(s) replaced     *)	set {tempTID, AppleScript's text item delimiters} to {AppleScript's text item delimiters, oldItem}	try		set {itemList, AppleScript's text item delimiters} to {text items of someText, newItem}		set {someText, AppleScript's text item delimiters} to {itemList as text, tempTID}	on error errorMessage number errorNumber -- oops		set AppleScript's text item delimiters to tempTID		error errorMessage number errorNumber -- pass it on	end try		return someTextend replaceTexttell application "Aperture"	activate	set imageSel to (get selection)	set proj to (get project)	if imageSel is {} then		error "Please select an image."	else		set selectedImage to item 1 of imageSel		set proj to parent of selectedImage		set newAlbumName to "duplicates"		tell proj			if album newAlbumName of proj exists then							else				make new album with properties {name:newAlbumName}			end if						set dupAlbum to album newAlbumName of proj		end tell		set images to image versions of proj				#for all images		repeat with i from 1 to count of images			set jpgImage to item i of images			set fileName to (get the value of the other tag "FileName" of jpgImage)						if (fileName contains ".JPG") or (fileName contains ".jpg") then				set newName to my replaceText(fileName, ".JPG", ".RAF")								#find raw counterpart				repeat with i from 1 to count of images					set rawImage to item i of images					set newFileName to (get the value of the other tag "FileName" of rawImage)										#we found it!					if newName is newFileName then						set rawRating to main rating of rawImage						set jpgRating to main rating of jpgImage												#if raw file rating is 4 or above and jpg is less than 4						#we delete the jpg						if rawRating > 3 and jpgRating < 4 then							tell dupAlbum								duplicate jpgImage to dupAlbum							end tell						end if												#if jpg is above 4, we set raw file to the same						if jpgRating >= 4 then							tell rawImage								set main rating to jpgRating							end tell						end if												# if rating of jpg or raw is -1, we delete both the raw and the jpg						if rawRating < 0 or jpgRating < 0 then							tell dupAlbum								duplicate jpgImage to dupAlbum								duplicate rawImage to dupAlbum							end tell						end if												#both ratings are below 4, we delete raw						if rawRating < 4 and jpgRating < 4 then							tell dupAlbum								duplicate rawImage to dupAlbum							end tell						end if											end if				end repeat			end if		end repeat	end if	display dialog "Removed unnecessary images"end tell